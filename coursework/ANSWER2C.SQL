--CREATING THE VIEWS AS IN QUESTION 2B
CREATE OR REPLACE VIEW STUDENT_PROPOSAL_MARKS AS
SELECT YEAR, STUDENT, ROUND(AVG(MARK),0 ) AS MARK
FROM PROJ_PROPOSAL_EXAMINER_MARKS PPE
WHERE STUDENT NOT IN (
    SELECT PX.STUDENT 
    FROM PROJ_PROPOSAL_EXAMINER_MARKS PX
    WHERE PX.MARK IS NULL
    )
GROUP BY STUDENT, YEAR;

CREATE OR REPLACE VIEW STUDENT_REPORT_MARKS AS
SELECT YEAR, STUDENT, ROUND(AVG(MARK),0) AS MARK
FROM PROJ_REPORT_EXAMINER_MARKS PRE
WHERE STUDENT NOT IN (
    SELECT PX.STUDENT 
    FROM PROJ_PROPOSAL_EXAMINER_MARKS PX
    WHERE PX.MARK IS NULL
    )
GROUP BY STUDENT, YEAR;

-- COMBINING BOTH THE VIEWS
CREATE OR REPLACE VIEW PROJ_OVERALL_MARKS(YEAR, STUDENT, PROPOSAL_MARK, REPORT_MARK, PROJECT_MARK) AS 
SELECT SPM.YEAR, SPM.STUDENT, SPM.MARK, SRM.MARK,
    ROUND(0.2 * SPM.MARK + 0.8 * SRM.MARK, 0) AS "PROJECT_MARK"
FROM STUDENT_PROPOSAL_MARKS SPM, STUDENT_REPORT_MARKS SRM
WHERE SPM.STUDENT = SRM.STUDENT;

-- HIDING IT FROM STUDENTS
CREATE OR REPLACE VIEW RECORDS_VIEW AS
SELECT *
FROM PROJ_DETAILS
WHERE STUDENT = USER OR USER IN (SELECT * FROM PROJ_EXAMINERS);

SELECT * 
FROM RECORDS_VIEW