CREATE OR REPLACE VIEW STUDENT_PROPOSAL_MARKS AS
SELECT YEAR, STUDENT, ROUND(AVG(MARK),0 ) AS MARK
FROM PROJ_PROPOSAL_EXAMINER_MARKS PPE
WHERE STUDENT NOT IN (
    SELECT PX.STUDENT 
    FROM PROJ_PROPOSAL_EXAMINER_MARKS PX
    WHERE PX.MARK IS NULL
    )
GROUP BY STUDENT, YEAR;

CREATE OR REPLACE VIEW STUDENT_REPORT_MARKS AS
SELECT YEAR, STUDENT, ROUND(AVG(MARK),0) AS MARK
FROM PROJ_REPORT_EXAMINER_MARKS PRE
WHERE STUDENT NOT IN (
    SELECT PX.STUDENT 
    FROM PROJ_PROPOSAL_EXAMINER_MARKS PX
    WHERE PX.MARK IS NULL
    )
GROUP BY STUDENT, YEAR;


--TO HIDE THE VIEWS FROM OTHER STUDENTS
CREATE OR REPLACE VIEW PROJ_PROPOSAL_MARKS AS
SELECT *
FROM STUDENT_PROPOSAL_MARKS
WHERE STUDENT = USER OR USER IN (SELECT * FROM PROJ_EXAMINERS);

SELECT * 
FROM PROJ_PROPOSAL_MARKS;

CREATE OR REPLACE VIEW PROJ_REPORT_MARKS AS
SELECT *
FROM STUDENT_REPORT_MARKS
WHERE STUDENT = USER OR USER IN (SELECT * FROM PROJ_EXAMINERS);

SELECT *
FROM PROJ_REPORT_MARKS;
